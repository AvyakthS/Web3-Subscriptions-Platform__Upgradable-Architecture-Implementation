<!-- index.html (Landing with Firebase Auth + Firestore init) -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Web3 Subscriptions Platform</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
    <style>
        :root {
            --bg: #0b0f17;
            --card: #121826;
            --muted: #93a1b1;
            --text: #e8eef7;
            --accent: #7c5cff;
            --accent-2: #22c55e;
            --danger: #ef4444;
            --border: #263044;
        }
        * { box-sizing: border-box; }
        body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--text); background: radial-gradient(1200px 600px at 50% -10%, #1f2740 0%, var(--bg) 55%); min-height:100dvh; display:grid; grid-template-rows:auto 1fr auto; }
        header { display:flex; align-items:center; justify-content:space-between; padding:14px 20px; }
        .brand { font-weight:700; letter-spacing:.2px; }
        .right { display:flex; gap:10px; align-items:center; }
        button, .btn { cursor:pointer; padding:10px 14px; border-radius:10px; border:1px solid var(--border); color:var(--text); background:#0e1422; }
        button.primary { background: linear-gradient(180deg, #8e75ff, #6b4bff); border-color: transparent; }
        button.success { background: linear-gradient(180deg, #35d770, #16a34a); border-color: transparent; }
        .avatar { width:28px; height:28px; border-radius:50%; background:#2b3650; display:inline-flex; align-items:center; justify-content:center; font-size:12px; color:#c7d2fe; border:1px solid #3b4666; }
        main { display:grid; place-items:center; padding:24px; }
        .center-card { width:min(860px, 92vw); border:1px solid var(--border); background:linear-gradient(180deg, rgba(18,24,38,.7), rgba(12,16,27,.7)); backdrop-filter: blur(6px); border-radius:16px; padding:40px 28px 30px; text-align:center; box-shadow:0 20px 80px rgba(0,0,0,.35); }
        h1 { margin:0 0 8px; font-size: clamp(26px, 3.4vw, 40px); }
        .tagline { color: var(--muted); margin-bottom: 28px; }
        .actions { display:flex; gap:12px; justify-content:center; margin-bottom:6px; flex-wrap:wrap; }
        .footnote { text-align:center; color:var(--muted); font-size:13px; line-height:1.25rem; padding:14px 12px 26px; }
    </style>
</head>

<body>

<header>
    <div class="brand">Web3 Subscriptions Platform</div>
    <div class="right">
        <button id="walletBtn">Connect Your MetaMask Wallet</button>
        <button id="googleBtn">Sign in with your Google Account</button>
        <div id="googleChip" style="display:none; gap:6px; align-items:center;">
            <div id="googleAvatar" class="avatar">G</div>
            <span id="googleName" style="font-size:14px; color:#dbe4ff;"></span>
        </div>
    </div>
</header>

<main>
    <div class="center-card">
        <h1>Web3 Subscriptions Platform</h1>
        <p class="tagline">The decentralized Stripe for Web3 is here, powered by Polygon</p>
        <div class="actions">
            <button class="primary" id="toCreators">For Plan Creators</button>
            <button class="success" id="toSubscribers">For Plan Subscribers</button>
        </div>
        <p style="color:#aab6d6; font-size:13px; margin-top:6px;">Please connect wallet and sign in with Google to continue.</p>
    </div>
</main>

<footer>
    <div class="footnote">
        "Created by Avyakth S.<br>This is a hobby project.<br>Contact me at avyakth1000@gmail.com to provide feedback."
    </div>
</footer>

<script>
    // ---------- Firebase init (requires SDK scripts loaded beforehand) ----------
    // Ensure the Firebase SDK (app-compat, auth-compat, firestore-compat) is loaded before this block.
    const firebaseConfig = {
        apiKey: "AIzaSyDYQmS0_qmZvTI8kt2lk7hwjVn2XZumkpU",
        authDomain: "web3-subscriptions-platform.firebaseapp.com",
        projectId: "web3-subscriptions-platform",
        storageBucket: "web3-subscriptions-platform.firebasestorage.app",
        messagingSenderId: "958526009151",
        appId: "1:958526009151:web:924c316a438abc5cdc6d8a",
        measurementId: "G-P6H1T71N0N"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ---------- Utilities ----------
    function short(addr){ return addr ? addr.slice(0,6) + 'â€¦' + addr.slice(-4) : ''; }
    function randHex(bytes=20){
        const a = crypto.getRandomValues(new Uint8Array(bytes));
        return '0x' + Array.from(a).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    function bothConnected(){
        return localStorage.getItem('walletConnected') === '1' && !!auth.currentUser;
    }

    // ---------- Wallet connect ----------
    async function connectWallet(){
        try{
            if(window.ethereum?.request){
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const addr = accounts[0];
                localStorage.setItem('walletAddress', addr);
                localStorage.setItem('walletConnected', '1');
                updateTopbar();
                return;
            }
        }catch(e){}
        const addr = prompt('Enter a wallet address (demo fallback):');
        if(addr?.startsWith('0x')){
            localStorage.setItem('walletAddress', addr);
            localStorage.setItem('walletConnected', '1');
            updateTopbar();
        }else{
            alert('Wallet connection failed.');
        }
    }

    // ---------- Google sign-in (Firebase Auth) ----------
    async function googleSignIn(){
        const provider = new firebase.auth.GoogleAuthProvider();
        try{
            const res = await auth.signInWithPopup(provider);
            const user = res.user;
            await db.collection('events').add({
                type: 'login',
                uid: user.uid,
                email: user.email || '',
                ts: firebase.firestore.FieldValue.serverTimestamp()
            });
        }catch(e){
            alert('Google sign-in failed.');
        }
    }

    // ---------- UI updates ----------
    function updateTopbar(){
        const walletBtn = document.getElementById('walletBtn');
        const googleBtn = document.getElementById('googleBtn');
        const gChip = document.getElementById('googleChip');
        const gName = document.getElementById('googleName');
        const gAvatar = document.getElementById('googleAvatar');

        const wal = localStorage.getItem('walletAddress');
        const wConn = localStorage.getItem('walletConnected') === '1';
        if(wConn && wal){ walletBtn.textContent = short(wal); walletBtn.disabled = true; }
        else { walletBtn.textContent = 'Connect Your MetaMask Wallet'; walletBtn.disabled = false; }

        const u = auth.currentUser;
        if(u){
            googleBtn.style.display = 'none';
            gChip.style.display = 'inline-flex';
            const name = u.displayName || 'GUser';
            gName.textContent = name;
            if(u.photoURL){
                gAvatar.style.background = `center/cover no-repeat url(${u.photoURL})`;
                gAvatar.textContent = '';
            }else{
                gAvatar.style.background = '#2b3650';
                gAvatar.textContent = (name || 'G').slice(0,1).toUpperCase();
            }
        }else{
            googleBtn.style.display = 'inline-block';
            gChip.style.display = 'none';
        }
    }

    auth.onAuthStateChanged(()=>updateTopbar());

    // ---------- Nav gating ----------
    function goIfAuthed(path){
        if(bothConnected()){ window.location.href = path; }
        else { alert('Please connect MetaMask and sign in with Google to continue.'); }
    }

    document.getElementById('walletBtn').addEventListener('click', connectWallet);
    document.getElementById('googleBtn').addEventListener('click', googleSignIn);
    document.getElementById('toCreators').addEventListener('click', ()=>goIfAuthed('creators.html'));
    document.getElementById('toSubscribers').addEventListener('click', ()=>goIfAuthed('subscribers.html'));
    updateTopbar();
</script>
</body>
</html>
